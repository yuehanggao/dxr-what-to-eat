<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤©åƒä»€ä¹ˆ - è½¬ç›˜å†³å®š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto 40px;
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            position: relative;
            overflow: hidden;
            background: transparent;
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            overflow: visible;
        }

        .segment-path {
            width: 100%;
            height: 100%;
        }

        .segment-text {
            position: absolute;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-size: 18px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 2;
        }

        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ff4757;
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            border: 4px solid #667eea;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #667eea;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .result {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #ff4757;
            margin: 20px 0;
            min-height: 40px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .spin-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .spin-button:active {
            transform: translateY(0);
        }

        .spin-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .food-list {
            margin-top: 30px;
        }

        .food-list h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.5em;
        }

        .food-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .food-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .food-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-button, .remove-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .add-button {
            background: #2ecc71;
            color: white;
        }

        .add-button:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .remove-button {
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .remove-button:hover {
            background: #c0392b;
        }

        .food-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .food-item {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #e9ecef;
        }

        .food-item span {
            color: #333;
            font-weight: 500;
        }

        .empty-message {
            color: #999;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        @media (max-width: 600px) {
            .wheel-container {
                width: 300px;
                height: 300px;
            }

            h1 {
                font-size: 2em;
            }

            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ½ï¸ ç¯èŠ¯ç»’ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</h1>
        
        <div class="wheel-container">
            <div class="pointer"></div>
            <div id="wheel"></div>
            <div class="center-circle">è½¬ç›˜</div>
        </div>

        <div class="result" id="result"></div>

        <div class="controls">
            <button class="spin-button" id="spinButton">å¼€å§‹æ—‹è½¬</button>
        </div>

        <div class="food-list">
            <h2>æ·»åŠ é£Ÿç‰©é€‰é¡¹</h2>
            <div class="food-input-group">
                <input type="text" class="food-input" id="foodInput" placeholder="è¾“å…¥é£Ÿç‰©åç§°ï¼Œä¾‹å¦‚ï¼šç«é”…ã€çƒ§çƒ¤ã€æ—¥æ–™...">
                <button class="add-button" id="addButton">æ·»åŠ </button>
            </div>
            <div class="food-items" id="foodItems"></div>
            
            <div class="data-actions" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e9ecef;">
                <h3 style="margin-bottom: 15px; color: #333; font-size: 1.2em;">æ•°æ®ç®¡ç†</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="export-button" id="exportButton" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button class="import-button" id="importButton" style="padding: 10px 20px; background: #9b59b6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    <button class="share-button" id="shareButton" style="padding: 10px 20px; background: #e67e22; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;">ğŸ”— ç”Ÿæˆåˆ†äº«é“¾æ¥</button>
                    <button class="qrcode-button" id="qrcodeButton" style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;">ğŸ“± ç”ŸæˆäºŒç»´ç </button>
                </div>
                <div id="dataInfo" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 12px; color: #666; display: none;"></div>
                <div id="qrcodeContainer" style="margin-top: 15px; text-align: center; display: none;">
                    <div id="qrcode" style="display: inline-block; padding: 10px; background: white; border-radius: 8px;"></div>
                    <p style="margin-top: 10px; font-size: 12px; color: #666;">ç”¨æ‰‹æœºæ‰«æäºŒç»´ç å³å¯æ‰“å¼€</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let foods = [];
        let isSpinning = false;
        let rotation = 0;

        // ä»localStorageåŠ è½½é£Ÿç‰©åˆ—è¡¨
        function loadFoods() {
            // é¦–å…ˆæ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰æ•°æ®
            const urlParams = new URLSearchParams(window.location.search);
            const urlData = urlParams.get('data');
            if (urlData) {
                try {
                    const decoded = decodeURIComponent(urlData);
                    foods = JSON.parse(decoded);
                    saveFoods();
                    // æ¸…é™¤URLå‚æ•°ï¼Œé¿å…åˆ·æ–°æ—¶é‡å¤å¯¼å…¥
                    window.history.replaceState({}, document.title, window.location.pathname);
                    showInfo('å·²ä»é“¾æ¥å¯¼å…¥æ•°æ®ï¼', 'success');
                } catch (e) {
                    console.error('å¯¼å…¥URLæ•°æ®å¤±è´¥:', e);
                }
            }
            
            // å¦‚æœæ²¡æœ‰URLæ•°æ®ï¼Œä»localStorageåŠ è½½
            if (foods.length === 0) {
                const saved = localStorage.getItem('foodWheelItems');
                if (saved) {
                    foods = JSON.parse(saved);
                } else {
                    // é»˜è®¤é£Ÿç‰©
                    foods = ['ç«é”…', 'çƒ§çƒ¤', 'æ—¥æ–™', 'å·èœ', 'ç²¤èœ', 'è¥¿é¤', 'å¿«é¤', 'å®¶å¸¸èœ'];
                }
            }
            updateFoodList();
            drawWheel();
        }
        
        // æ˜¾ç¤ºä¿¡æ¯
        function showInfo(message, type = 'info') {
            const infoDiv = document.getElementById('dataInfo');
            infoDiv.innerHTML = message;
            infoDiv.style.display = 'block';
            if (type === 'success') {
                infoDiv.style.background = '#d4edda';
                infoDiv.style.color = '#155724';
            } else if (type === 'error') {
                infoDiv.style.background = '#f8d7da';
                infoDiv.style.color = '#721c24';
            } else {
                infoDiv.style.background = '#f8f9fa';
                infoDiv.style.color = '#666';
            }
            // é”™è¯¯ä¿¡æ¯ä¸è‡ªåŠ¨éšè—
            if (type !== 'error') {
                setTimeout(() => {
                    infoDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(foods, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'food_wheel_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showInfo('æ•°æ®å·²å¯¼å‡ºï¼', 'success');
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const imported = JSON.parse(event.target.result);
                            if (Array.isArray(imported)) {
                                foods = imported;
                                saveFoods();
                                updateFoodList();
                                drawWheel();
                                showInfo(`æˆåŠŸå¯¼å…¥ ${foods.length} ä¸ªé£Ÿç‰©é€‰é¡¹ï¼`, 'success');
                            } else {
                                showInfo('æ•°æ®æ ¼å¼é”™è¯¯ï¼', 'error');
                            }
                        } catch (error) {
                            showInfo('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // ç”Ÿæˆåˆ†äº«é“¾æ¥
        function generateShareLink() {
            const dataStr = JSON.stringify(foods);
            const encoded = encodeURIComponent(dataStr);
            const currentUrl = window.location.href.split('?')[0];
            const shareUrl = `${currentUrl}?data=${encoded}`;
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬åœ°æ–‡ä»¶
            if (window.location.protocol === 'file:') {
                showInfo('âš ï¸ å½“å‰æ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œé“¾æ¥æ— æ³•åœ¨æ‰‹æœºä¸Šç›´æ¥æ‰“å¼€ï¼<br>è¯·ä½¿ç”¨"ç”ŸæˆäºŒç»´ç "åŠŸèƒ½ï¼Œæˆ–éƒ¨ç½²åˆ°æœåŠ¡å™¨åä½¿ç”¨ã€‚', 'error');
                showShareUrl(shareUrl, true);
                return;
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showInfo('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼å¯ä»¥å‘é€åˆ°æ‰‹æœºæ‰“å¼€ã€‚', 'success');
                }).catch(() => {
                    // å¦‚æœå¤åˆ¶å¤±è´¥ï¼Œæ˜¾ç¤ºé“¾æ¥è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
                    showShareUrl(shareUrl);
                });
            } else {
                // ä¸æ”¯æŒå‰ªè´´æ¿APIï¼Œæ˜¾ç¤ºé“¾æ¥
                showShareUrl(shareUrl);
            }
        }
        
        // ç”ŸæˆäºŒç»´ç 
        function generateQRCode() {
            const dataStr = JSON.stringify(foods);
            const encoded = encodeURIComponent(dataStr);
            const currentUrl = window.location.href.split('?')[0];
            const shareUrl = `${currentUrl}?data=${encoded}`;
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬åœ°æ–‡ä»¶
            if (window.location.protocol === 'file:') {
                showInfo('âš ï¸ æœ¬åœ°æ–‡ä»¶æ— æ³•ç”Ÿæˆå¯ç”¨çš„äºŒç»´ç ï¼<br><br><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>1. ä½¿ç”¨"å¯¼å‡ºæ•°æ®"åŠŸèƒ½ï¼Œå°†JSONæ–‡ä»¶ä¼ åˆ°æ‰‹æœº<br>2. æˆ–å°†æ–‡ä»¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ˆGitHub Pagesç­‰ï¼‰', 'error');
                return;
            }
            
            // ä½¿ç”¨åœ¨çº¿äºŒç»´ç APIç”ŸæˆäºŒç»´ç 
            const qrcodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(shareUrl)}`;
            const qrcodeContainer = document.getElementById('qrcodeContainer');
            const qrcodeDiv = document.getElementById('qrcode');
            
            qrcodeDiv.innerHTML = `<img src="${qrcodeUrl}" alt="äºŒç»´ç " style="max-width: 100%; height: auto;">`;
            qrcodeContainer.style.display = 'block';
            showInfo('äºŒç»´ç å·²ç”Ÿæˆï¼ç”¨æ‰‹æœºæ‰«æå³å¯æ‰“å¼€å¹¶è‡ªåŠ¨å¯¼å…¥æ•°æ®ã€‚', 'success');
        }
        
        // æ˜¾ç¤ºåˆ†äº«é“¾æ¥
        function showShareUrl(url, isLocalFile = false) {
            const infoDiv = document.getElementById('dataInfo');
            const warning = isLocalFile ? '<p style="color: #e74c3c; margin-bottom: 10px;"><strong>âš ï¸ æ³¨æ„ï¼šè¿™æ˜¯æœ¬åœ°æ–‡ä»¶é“¾æ¥ï¼Œæ‰‹æœºæ— æ³•ç›´æ¥æ‰“å¼€ï¼</strong></p>' : '';
            infoDiv.innerHTML = `
                ${warning}
                <strong>åˆ†äº«é“¾æ¥ï¼š</strong><br>
                <input type="text" value="${url}" readonly 
                    style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;"
                    onclick="this.select()">
                <p style="margin-top: 5px; font-size: 11px; color: #999;">${isLocalFile ? 'æœ¬åœ°æ–‡ä»¶é“¾æ¥æ— æ³•åœ¨æ‰‹æœºä¸Šä½¿ç”¨ï¼Œè¯·ä½¿ç”¨"å¯¼å‡ºæ•°æ®"åŠŸèƒ½æˆ–éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚' : 'ç‚¹å‡»è¾“å…¥æ¡†å…¨é€‰ï¼Œç„¶åå¤åˆ¶é“¾æ¥å‘é€åˆ°æ‰‹æœºå³å¯'}</p>
            `;
            infoDiv.style.display = 'block';
        }

        // ä¿å­˜é£Ÿç‰©åˆ—è¡¨åˆ°localStorage
        function saveFoods() {
            localStorage.setItem('foodWheelItems', JSON.stringify(foods));
        }

        // ç»˜åˆ¶è½¬ç›˜
        function drawWheel() {
            const wheel = document.getElementById('wheel');
            wheel.innerHTML = '';
            
            if (foods.length === 0) {
                wheel.style.background = '#f0f0f0';
                return;
            }

            // ä½¿ç”¨æ›´é²œè‰³ã€å¯¹æ¯”åº¦æ›´é«˜çš„é¢œè‰²
            const colors = [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A',
                '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2',
                '#F8B739', '#95E1D3', '#F38181', '#AA96DA',
                '#FF6B9D', '#C44569', '#6C5CE7', '#00D2D3',
                '#FFC312', '#FF6348', '#5F27CD', '#00D2FF',
                '#FF9FF3', '#54A0FF', '#5F27CD', '#00D2D3'
            ];

            const size = 400;
            const center = size / 2;
            const radius = size / 2 - 8; // å‡å»è¾¹æ¡†å®½åº¦
            const angle = 360 / foods.length;
            
            // åˆ›å»º SVG
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', size);
            svg.setAttribute('height', size);
            svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            
            // æ·»åŠ æ–‡å­—é˜´å½±æ•ˆæœï¼ˆå…±äº«filterï¼‰
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const filter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            filter.setAttribute('id', 'text-shadow');
            const feDropShadow = document.createElementNS('http://www.w3.org/2000/svg', 'feDropShadow');
            feDropShadow.setAttribute('dx', '2');
            feDropShadow.setAttribute('dy', '2');
            feDropShadow.setAttribute('stdDeviation', '2');
            feDropShadow.setAttribute('flood-opacity', '0.5');
            filter.appendChild(feDropShadow);
            defs.appendChild(filter);
            svg.appendChild(defs);
            
            foods.forEach((food, index) => {
                const startAngle = (index * angle - 90) * Math.PI / 180;
                const endAngle = ((index + 1) * angle - 90) * Math.PI / 180;
                
                // è®¡ç®—æ‰‡å½¢è·¯å¾„
                const x1 = center + radius * Math.cos(startAngle);
                const y1 = center + radius * Math.sin(startAngle);
                const x2 = center + radius * Math.cos(endAngle);
                const y2 = center + radius * Math.sin(endAngle);
                
                const largeArc = angle > 180 ? 1 : 0;
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const pathData = `M ${center} ${center} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;
                path.setAttribute('d', pathData);
                path.setAttribute('fill', colors[index % colors.length]);
                path.setAttribute('stroke', '#fff');
                path.setAttribute('stroke-width', '3'); // å¢åŠ è¾¹æ¡†å®½åº¦ï¼Œä½¿åˆ†å—æ›´æ˜æ˜¾
                path.setAttribute('stroke-linejoin', 'round');
                svg.appendChild(path);
                
                // æ·»åŠ æ–‡å­—
                const textAngle = (index * angle + angle / 2 - 90) * Math.PI / 180;
                const textRadius = radius * 0.65; // æ–‡å­—è·ç¦»ä¸­å¿ƒçš„è·ç¦»
                const textX = center + textRadius * Math.cos(textAngle);
                const textY = center + textRadius * Math.sin(textAngle);
                
                // æ ¹æ®é£Ÿç‰©æ•°é‡å’Œè§’åº¦è‡ªåŠ¨è°ƒæ•´å­—ä½“å¤§å°
                let fontSize = 18;
                if (foods.length > 8) fontSize = 14;
                if (foods.length > 12) fontSize = 12;
                if (angle < 30) fontSize = Math.max(10, fontSize - 2);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', textX);
                text.setAttribute('y', textY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', fontSize);
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('font-family', 'Microsoft YaHei, Arial, sans-serif');
                
                // ä½¿ç”¨å…±äº«çš„æ–‡å­—é˜´å½±æ•ˆæœ
                text.setAttribute('filter', 'url(#text-shadow)');
                text.textContent = food;
                svg.appendChild(text);
            });
            
            wheel.appendChild(svg);
        }

        // æ›´æ–°é£Ÿç‰©åˆ—è¡¨æ˜¾ç¤º
        function updateFoodList() {
            const container = document.getElementById('foodItems');
            container.innerHTML = '';
            
            if (foods.length === 0) {
                container.innerHTML = '<div class="empty-message">è¿˜æ²¡æœ‰æ·»åŠ é£Ÿç‰©ï¼Œå¿«æ·»åŠ ä¸€äº›å§ï¼</div>';
                return;
            }

            foods.forEach((food, index) => {
                const item = document.createElement('div');
                item.className = 'food-item';
                item.innerHTML = `
                    <span>${food}</span>
                    <button class="remove-button" onclick="removeFood(${index})">åˆ é™¤</button>
                `;
                container.appendChild(item);
            });
        }

        // æ·»åŠ é£Ÿç‰©
        function addFood() {
            const input = document.getElementById('foodInput');
            const food = input.value.trim();
            
            if (food === '') {
                alert('è¯·è¾“å…¥é£Ÿç‰©åç§°ï¼');
                return;
            }
            
            if (foods.includes(food)) {
                alert('è¿™ä¸ªé£Ÿç‰©å·²ç»å­˜åœ¨äº†ï¼');
                return;
            }
            
            foods.push(food);
            input.value = '';
            saveFoods();
            updateFoodList();
            drawWheel();
        }

        // åˆ é™¤é£Ÿç‰©
        function removeFood(index) {
            foods.splice(index, 1);
            saveFoods();
            updateFoodList();
            drawWheel();
        }

        // æ—‹è½¬è½¬ç›˜
        function spinWheel() {
            if (isSpinning || foods.length === 0) return;
            
            isSpinning = true;
            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('wheel');
            const result = document.getElementById('result');
            
            spinButton.disabled = true;
            result.textContent = '';
            
            // éšæœºæ—‹è½¬è§’åº¦ï¼ˆè‡³å°‘è½¬3åœˆï¼‰
            const spins = 3 + Math.random() * 2; // 3-5åœˆ
            const randomAngle = Math.random() * 360;
            const totalRotation = rotation + spins * 360 + randomAngle;
            
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            rotation = totalRotation % 360;
            
            // è®¡ç®—æœ€ç»ˆé€‰ä¸­çš„é£Ÿç‰©
            setTimeout(() => {
                const anglePerItem = 360 / foods.length;
                // æŒ‡é’ˆåœ¨é¡¶éƒ¨ï¼Œåœ¨æ•°å­¦åæ ‡ç³»ä¸­æ˜¯270åº¦ï¼ˆ-90åº¦ï¼‰
                const pointerAngle = 270;
                
                // CSS rotateæ˜¯é¡ºæ—¶é’ˆæ—‹è½¬ï¼Œè½¬ç›˜é¡ºæ—¶é’ˆæ—‹è½¬rotationåº¦
                // è½¬ç›˜åˆå§‹æ—¶ï¼Œæ‰‡å½¢iä» (i * anglePerItem - 90)åº¦ å¼€å§‹ï¼ˆæ•°å­¦åæ ‡ç³»ï¼‰
                // è½¬ç›˜é¡ºæ—¶é’ˆæ—‹è½¬rotationåº¦åï¼Œè½¬ç›˜ä¸Šçš„ç‚¹éƒ½é¡ºæ—¶é’ˆç§»åŠ¨äº†rotationåº¦
                // æŒ‡é’ˆå›ºå®šåœ¨é¡¶éƒ¨ï¼ˆ270åº¦ï¼‰ï¼Œæ‰€ä»¥å®ƒæŒ‡å‘è½¬ç›˜ä¸ŠåŸæœ¬åœ¨ (270 - rotation) % 360 åº¦çš„ä½ç½®
                
                // è®¡ç®—æŒ‡é’ˆæŒ‡å‘çš„è½¬ç›˜ä¸Šçš„è§’åº¦ï¼ˆè½¬ç›˜åˆå§‹ä½ç½®æ—¶çš„è§’åº¦ï¼‰
                const targetAngle = (270 - rotation) % 360;
                const targetAngleNormalized = (targetAngle + 360) % 360;
                
                // æ‰¾åˆ°åŒ…å«è¿™ä¸ªè§’åº¦çš„æ‰‡å½¢
                let selectedIndex = 0;
                let found = false;
                
                for (let i = 0; i < foods.length; i++) {
                    // æ‰‡å½¢içš„èµ·å§‹è§’åº¦ï¼ˆè½¬ç›˜åˆå§‹ä½ç½®ï¼Œæ•°å­¦åæ ‡ç³»ï¼‰
                    let startAngle = (i * anglePerItem - 90) % 360;
                    if (startAngle < 0) startAngle += 360;
                    
                    // æ‰‡å½¢içš„ç»“æŸè§’åº¦ï¼ˆè½¬ç›˜åˆå§‹ä½ç½®ï¼Œæ•°å­¦åæ ‡ç³»ï¼‰
                    let endAngle = ((i + 1) * anglePerItem - 90) % 360;
                    if (endAngle < 0) endAngle += 360;
                    
                    // æ£€æŸ¥ç›®æ ‡è§’åº¦æ˜¯å¦åœ¨è¿™ä¸ªæ‰‡å½¢çš„èŒƒå›´å†…
                    if (startAngle < endAngle) {
                        // æ­£å¸¸æƒ…å†µï¼šèµ·å§‹è§’åº¦ < ç»“æŸè§’åº¦
                        if (targetAngleNormalized >= startAngle && targetAngleNormalized < endAngle) {
                            selectedIndex = i;
                            found = true;
                            break;
                        }
                    } else {
                        // è·¨è¶Š0åº¦çš„æƒ…å†µï¼šèµ·å§‹è§’åº¦ > ç»“æŸè§’åº¦ï¼ˆä¾‹å¦‚ï¼š350åº¦åˆ°10åº¦ï¼‰
                        if (targetAngleNormalized >= startAngle || targetAngleNormalized < endAngle) {
                            selectedIndex = i;
                            found = true;
                            break;
                        }
                    }
                }
                
                // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œä½¿ç”¨ä¸­å¿ƒç‚¹æœ€è¿‘çš„æ–¹æ³•
                if (!found) {
                    let minDiff = 360;
                    for (let i = 0; i < foods.length; i++) {
                        const centerAngle = (i * anglePerItem + anglePerItem / 2 - 90) % 360;
                        const centerAngleNormalized = (centerAngle + 360) % 360;
                        let diff = Math.abs(centerAngleNormalized - targetAngleNormalized);
                        if (diff > 180) diff = 360 - diff;
                        if (diff < minDiff) {
                            minDiff = diff;
                            selectedIndex = i;
                        }
                    }
                }
                
                result.textContent = `ğŸ‰ ä»Šå¤©åƒï¼š${foods[selectedIndex]}ï¼`;
                isSpinning = false;
                spinButton.disabled = false;
            }, 4000);
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('addButton').addEventListener('click', addFood);
        document.getElementById('foodInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addFood();
            }
        });
        document.getElementById('spinButton').addEventListener('click', spinWheel);
        document.getElementById('exportButton').addEventListener('click', exportData);
        document.getElementById('importButton').addEventListener('click', importData);
        document.getElementById('shareButton').addEventListener('click', generateShareLink);
        document.getElementById('qrcodeButton').addEventListener('click', generateQRCode);

        // åˆå§‹åŒ–
        loadFoods();
    </script>
</body>
</html>
